name: Build

runs:
  using: composite

  steps:
    - name: Log GitHub context
      shell: bash
      run: echo "github.sha ${{github.sha}} - github.event.pull_request.head.sha ${{github.event.pull_request.head.sha}}"

    - name: Cache build
      uses: actions/cache@v3.3.1
      id: build-cache

      with:
        # Use faster GNU tar for all runners
        enableCrossOsArchive: true

        # Restore build cache (unless commit SHA changes)
        key: build-${{ runner.os }}-${{ github.sha }}
        path: |
          packages/*/dist
          shared/*/dist

    - name: Build
      id: build

      # Skip build when weâ€™ve built this SHA before
      if: steps.build-cache.outputs.cache-hit != 'true'
      shell: bash

      run: npm run build --workspaces --if-present
